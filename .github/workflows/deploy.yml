name: ðŸš€ Deploy website

on:
  push:
    branches:
      - master

jobs:
  web-deploy:
    name: ðŸŽ‰ Deploy
    runs-on: ubuntu-latest
    steps:
    - name: ðŸšš Get latest code
      uses: actions/checkout@v3

    - name: Set up PHP
      uses: shivammathur/setup-php@v2
      with:
        php-version: "8.1"

    - name: Update Composer dependencies
      run: composer update --no-interaction --prefer-dist

    - name: Set up Node.js
      uses: actions/setup-node@v4
      with:
        node-version: "20"

    - name: Install npm packages
      run: npm install

    - name: Build assets
      run: npm run build

    - name: Debug FTP connection
      run: |
        echo "Attempting to connect to FTP server..."
        nc -zv ftp.webefiy.tech 21

    - name: ðŸ“‚ Sync files
      uses: SamKirkland/FTP-Deploy-Action@v4.3.4
      with:
        server: ftp.webefiy.tech
        username: rameez@test.webefiy.tech
        password: ${{ secrets.PASSWORD }}
        server-dir: /
        protocol: ftps
